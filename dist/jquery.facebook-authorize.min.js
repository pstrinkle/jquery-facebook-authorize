(function($){function FacebookAuthorize(config){this.init(config)}FacebookAuthorize.prototype={required:[],optional:[],granted:[],constructor:FacebookAuthorize,el:null,init:function(config){$.extend(this,config)},dataName:"facebookAuthorize",clickHandler:function(event){console.log("clicked!");var el=$(this);var dataName=FacebookAuthorize.prototype.dataName;var instance=el.data(dataName);el.trigger("facebook-request-clicked");var params={};var requesting=[];$.each(instance.required,function(index,element){if(-1==$.inArray(element,instance.granted)){requesting.push(element)}});$.each(instance.optional,function(index,element){if(-1==$.inArray(element,instance.granted)){requesting.push(element)}});console.log("requesting: "+requesting);if(instance.granted.length>0){params["auth_type"]="rerequest";params["scope"]=requesting.join(",");params["return_scopes"]=true}else{params["scope"]=requesting.join(",");params["return_scopes"]=true}FB.login(function(response){if(response.status==="connected"){var missing_required=[],missing_optional=[];console.log(response);console.log(response.authResponse.accessToken);console.log(response.authResponse.grantedScopes);console.log(response.authResponse.userID);var scopes=response.authResponse.grantedScopes.split(",");console.log("scopes: "+scopes);$.each(scopes,function(index,element){instance.granted.push(element)});console.log("required: "+instance.required);console.log("optional: "+instance.optional);$.each(instance.required,function(index,element){if(-1==$.inArray(element,instance.granted)){missing_required.push(element)}});console.log("missing_required: "+missing_required);if(missing_required.length>0){el.trigger("facebook-missing-required",missing_required.join(","));return}$.each(instance.optional,function(index,element){if(-1==$.inArray(element,instance.granted)){missing_optional.push(element)}});el.trigger("facebook-success",[scopes.join(","),missing_optional.join(","),response.authResponse]);return}else if(response.status==="not_authorized"){el.trigger("facebook-not-authorized")}else{el.trigger("facebook-not-loggedin")}},params)}};$.fn.facebookAuthorize=function(configOrCommand){var dataName=FacebookAuthorize.prototype.dataName;return this.each(function(){var el=$(this),instance=el.data(dataName),config=$.isPlainObject(configOrCommand)?configOrCommand:{};if(instance){instance.init(config)}else{var initialConfig=$.extend({},el.data());config=$.extend(initialConfig,config);config.el=el;instance=new FacebookAuthorize(config);el.data(dataName,instance)}el.on("click",instance.clickHandler)})}})(jQuery);
